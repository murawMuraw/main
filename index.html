<script>
  let circle, wind = {speed: 0, deg: 0}; // deg — направление в градусах

  // Получение ветра из OpenWeather
  async function fetchWind(lat, lon) {
    const apiKey = '86e0eed4f14375c3b6f3212dfffed75b';
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;

    const response = await fetch(url);
    const data = await response.json();
    wind = data.wind;
    console.log('Wind:', wind);
  }

  ymaps.ready(function () {
    const map = new ymaps.Map("map", {
      center: [51.5, 0.0],
      zoom: 8
    });

    map.events.add('click', async function (e) {
      const coords = e.get('coords');

      await fetchWind(coords[0], coords[1]);

      if (circle) map.geoObjects.remove(circle);

      circle = new ymaps.Circle([
        coords,
        15000
      ], {}, {
        fillColor: "#87CEEB",
        fillOpacity: 0.1,
        strokeColor: "#87CEEB",
        strokeOpacity: 0.6,
        strokeWidth: 2
      });

      map.geoObjects.add(circle);
      map.setCenter(coords);

      // Запуск перемещения
      startWindMovement();
    });

    function startWindMovement() {
      setInterval(() => {
        if (!circle || wind.speed === 0) return;

        const coords = circle.geometry.getCoordinates();
        const lat = coords[0];
        const lon = coords[1];

        // Направление ветра в градусах (метео: откуда дует)
        const angleRad = (wind.deg + 180) * Math.PI / 180;

        // Простейшее смещение: 1 м/с ~ 0.00001 градуса в широте
        const dx = Math.cos(angleRad) * wind.speed * 0.00001;
        const dy = Math.sin(angleRad) * wind.speed * 0.00001;

        const newLat = lat + dy;
        const newLon = lon + dx;

        circle.geometry.setCoordinates([newLat, newLon]);
        map.setCenter([newLat, newLon]);
      }, 3000); // обновление каждые 3 секунды
    }
  });
</script>

