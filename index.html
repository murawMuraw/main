<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Прозрачный круг на затемнённой карте (Яндекс)</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <script>
    ymaps.ready(function () {
      const center = [51.5, 0.0]; // Гринвич
      const radius = 15000; // 15 км

      const map = new ymaps.Map("map", {
        center: center,
        zoom: 9
      });

      const outerCoords = [
        [85, -179.9999],
        [85, 179.9999],
        [-85, 179.9999],
        [-85, -179.9999],
        [85, -179.9999]
      ];

      // Вырезаем круг в обратном порядке (по часовой стрелке!)
      const hole = generateCircleCoordinates(center, radius, 100).reverse();

      const mask = new ymaps.Polygon([outerCoords, hole], {}, {
        fillColor: '#00000088', // затемнение
        strokeWidth: 0,
        fillRule: 'evenodd' // важно!
      });

      map.geoObjects.add(mask);
    });

    function generateCircleCoordinates(center, radius, points) {
      const coords = [];
      const R = 6371000; // радиус Земли, м
      const lat = center[0] * Math.PI / 180;
      const lon = center[1] * Math.PI / 180;

      for (let i = 0; i <= points; i++) {
        const angle = 2 * Math.PI * i / points;
        const dx = radius * Math.cos(angle);
        const dy = radius * Math.sin(angle);

        const latOffset = dy / R;
        const lonOffset = dx / (R * Math.cos(lat));

        coords.push([
          (lat + latOffset) * 180 / Math.PI,
          (lon + lonOffset) * 180 / Math.PI
        ]);
      }

      return coords;
    }
  </script>
</head>
<body>
  <div id="map"></div>
</body>
</html>
