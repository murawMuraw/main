<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта с радиусом 15 км (Яндекс)</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #windInfo {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 10px;
      background: rgba(255,255,255,0.8);
      font-family: sans-serif;
      z-index: 1000;
    }
  </style>
</head>
<body>
<div id="windInfo">Щелкните по карте, чтобы получить ветер</div>
<div id="map"></div>
<script>
  const apiKey = '080b3dab3f26f4e8d44b5d87f4c3ee78';
  let map, circle, windArrow, historyLine;
  const path = [];

  function getWindData(lat, lon) {
    return fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
      .then(response => response.json())
      .then(data => {
        const wind = data.wind;
        return {
          speed: wind.speed,         // м/с
          deg: wind.deg              // градусы (0 — север, 90 — восток)
        };
      });
  }

  ymaps.ready(function () {
    const startCoords = [51.5, 0.0]; // Гринвич

    map = new ymaps.Map("map", {
      center: startCoords,
      zoom: 8
    });

    // Круг в начальной точке
    circle = new ymaps.Circle([
      startCoords,
      15000
    ], {}, {
      fillColor: "#87CEEB",
      fillOpacity: 0.1,
      strokeColor: "#87CEEB",
      strokeOpacity: 0.6,
      strokeWidth: 2
    });
    map.geoObjects.add(circle);

    // Стрелка ветра
    windArrow = new ymaps.Placemark(startCoords, {
      iconCaption: "Ветер"
    }, {
      preset: "islands#redArrowIcon",
      iconRotate: true
    });
    map.geoObjects.add(windArrow);

    // Линия истории
    historyLine = new ymaps.Polyline([], {}, {
      strokeColor: "#0000FF",
      strokeWidth: 2,
      strokeOpacity: 0.5
    });
    map.geoObjects.add(historyLine);

    // Клик по карте — обновляем ветер
    map.events.add('click', function (e) {
      const newCoords = e.get('coords');

      getWindData(newCoords[0], newCoords[1]).then(wind => {
        document.getElementById('windInfo').innerText =
          `Скорость ветра: ${wind.speed} м/с\nНаправление: ${wind.deg}°`;

        // Поворачиваем стрелку
        windArrow.geometry.setCoordinates(circle.geometry.getCoordinates());
        windArrow.options.set('iconRotation', wind.deg);

        // Запускаем движение круга по ветру
        moveCircle(wind.speed, wind.deg);
      });
    });
  });

  function moveCircle(speed, deg) {
    const interval = 1000; // мс
    const metersPerStep = speed; // т.к. speed в м/с
    const angleRad = deg * Math.PI / 180;

    const dx = metersPerStep * Math.sin(angleRad);
    const dy = -metersPerStep * Math.cos(angleRad);

    const move = () => {
      const [lat, lon] = circle.geometry.getCoordinates();

      const newLat = lat + (dy / 111320); // приблизительно м -> градусы широты
      const newLon = lon + (dx / (40075000 * Math.cos(lat * Math.PI / 180) / 360)); // долгота

      const newCoords = [newLat, newLon];
      circle.geometry.setCoordinates(newCoords);
      windArrow.geometry.setCoordinates(newCoords);

      // Добавляем в историю
      path.push(newCoords);
      historyLine.geometry.setCoordinates(path);
    };

    // Останавливаем старое движение и запускаем новое
    if (window.circleTimer) clearInterval(window.circleTimer);
    path.push(circle.geometry.getCoordinates());
    window.circleTimer = setInterval(move, interval);
  }
</script>
</body>
</html>






