<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта с прозрачным кругом (Яндекс)</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <script>
    ymaps.ready(function () {
      const map = new ymaps.Map("map", {
        center: [51.5, 0.0], // Гринвич
        zoom: 8
      });

      let grayMask;

      map.events.add('click', function (e) {
        const coords = e.get('coords');

        if (grayMask) {
          map.geoObjects.remove(grayMask);
        }

        // Внешний контур (вся карта)
        const outerCoords = [
          [90, -180],
          [90, 180],
          [-90, 180],
          [-90, -180],
          [90, -180]
        ];

        // Внутренний контур (дырка-круг)
        const hole = generateCircle(coords, 15000, 100).reverse();

        grayMask = new ymaps.Polygon([outerCoords, hole], {}, {
          fillColor: 'rgba(128, 128, 128, 0.5)', // серый с прозрачностью
          strokeWidth: 0,
          fillRule: 'evenodd' // важно!
        });

        map.geoObjects.add(grayMask);
        map.setCenter(coords);
      });
    });

    // Генерация координат круга (дырки)
    function generateCircle(center, radius, points) {
      const coords = [];
      const R = 6371000; // радиус Земли, м
      const lat = center[0] * Math.PI / 180;
      const lon = center[1] * Math.PI / 180;

      for (let i = 0; i <= points; i++) {
        const angle = 2 * Math.PI * i / points;
        const dx = radius * Math.cos(angle);
        const dy = radius * Math.sin(angle);

        const latOffset = dy / R;
        const lonOffset = dx / (R * Math.cos(lat));

        coords.push([
          (lat + latOffset) * 180 / Math.PI,
          (lon + lonOffset) * 180 / Math.PI
        ]);
      }

      return coords;
    }
  </script>
</head>
<body>
  <div id="map"></div>
</body>
</html>







