<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта с прозрачным кругом (Яндекс)</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    ymaps.ready(function () {
      const map = new ymaps.Map("map", {
        center: [51.5, 0.0], // Гринвич
        zoom: 8
      });

      let mask;

      map.events.add('click', function (e) {
        const coords = e.get('coords');

        if (mask) {
          map.geoObjects.remove(mask);
        }

        // Внешний контур — вся карта
        const outer = [
          [85, -179.9999],
          [85, 179.9999],
          [-85, 179.9999],
          [-85, -179.9999],
          [85, -179.9999]
        ];

        // Круг — "дырка", которая должна быть по часовой стрелке!
        const hole = generateCircle(coords, 15000, 100).reverse();

        // Создаём многоугольник с дыркой
        mask = new ymaps.Polygon([outer, hole], {}, {
          fillColor: 'rgba(128, 128, 128, 0.5)', // серый фон с прозрачностью
          strokeWidth: 0,
          fillRule: 'evenodd'
        });

        map.geoObjects.add(mask);
        map.setCenter(coords);
      });
    });

    // Функция генерации координат круга (вырез)
    function generateCircle(center, radius, steps) {
      const coords = [];
      const R = 6371000; // радиус Земли в метрах
      const latRad = center[0] * Math.PI / 180;
      const lonRad = center[1] * Math.PI / 180;

      for (let i = 0; i <= steps; i++) {
        const angle = (2 * Math.PI * i) / steps;
        const dx = radius * Math.cos(angle);
        const dy = radius * Math.sin(angle);

        const dLat = dy / R;
        const dLon = dx / (R * Math.cos(latRad));

        const lat = latRad + dLat;
        const lon = lonRad + dLon;

        coords.push([
          lat * 180 / Math.PI,
          lon * 180 / Math.PI
        ]);
      }

      return coords;
    }
  </script>
</body>
</html>









