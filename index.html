<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта с ветром и историей</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #windInfo {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 100;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px;
      border-radius: 5px;
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="windInfo">Получение данных о ветре...</div>
  <div id="map"></div>

  <script>
    const apiKey = '080b3dab3f26f4e8d44b5d87f4c3ee78';
    let map, circle, windDirection = 0, windSpeed = 0;
    let circleCoords = [51.5, 0.0]; // Гринвич
    const radius = 15000; // радиус круга 15 км
    let pathCoords = [circleCoords]; // массив для хранения истории
    let polyline; // линия пути

    ymaps.ready(init);

    function init() {
      map = new ymaps.Map("map", {
        center: circleCoords,
        zoom: 8
      });

      circle = new ymaps.Circle([circleCoords, radius], {}, {
        fillColor: "#87CEEB",
        fillOpacity: 0.2,
        strokeColor: "#1E90FF",
        strokeOpacity: 0.8,
        strokeWidth: 2
      });

      polyline = new ymaps.Polyline(pathCoords, {}, {
        strokeColor: "#FF0000",
        strokeWidth: 3,
        strokeOpacity: 0.8
      });

      map.geoObjects.add(circle);
      map.geoObjects.add(polyline);

      getWindData();

      // каждые 60 секунд двигать круг
      setInterval(() => {
        getWindData(); // обновим данные о ветре
        moveCircleWithWind();
      }, 60000);
    }

    function getWindData() {
      const [lat, lon] = circleCoords;
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;

      fetch(url)
        .then(res => res.json())
        .then(data => {
          windSpeed = data.wind.speed;
          windDirection = data.wind.deg;
          updateWindInfo();
        })
        .catch(err => {
          document.getElementById("windInfo").textContent = "Ошибка загрузки ветра";
          console.error(err);
        });
    }

    function updateWindInfo() {
      document.getElementById("windInfo").textContent =
        `Ветер: ${windSpeed} м/с, Направление: ${windDirection}°`;
    }

    function moveCircleWithWind() {
      const distancePerMinute = windSpeed * 60; // в метрах за минуту
      const newCoords = movePoint(circleCoords, distancePerMinute, windDirection);
      circleCoords = newCoords;

      // Обновить круг
      circle.geometry.setCoordinates(newCoords);

      // Добавить точку в историю и обновить линию
      pathCoords.push(newCoords);
      polyline.geometry.setCoordinates(pathCoords);

      // Центрировать карту на новой позиции
      map.setCenter(newCoords);
    }

    // Перевод координат на заданное расстояние и направление
    function movePoint([lat, lon], distanceMeters, bearingDegrees) {
      const R = 6371000; // радиус Земли в метрах
      const bearing = bearingDegrees * Math.PI / 180;
      const lat1 = lat * Math.PI / 180;
      const lon1 = lon * Math.PI / 180;

      const lat2 = Math.asin(Math.sin(lat1) * Math.cos(distanceMeters / R) +
                  Math.cos(lat1) * Math.sin(distanceMeters / R) * Math.cos(bearing));
      const lon2 = lon1 + Math.atan2(Math.sin(bearing) * Math.sin(distanceMeters / R) * Math.cos(lat1),
                                     Math.cos(distanceMeters / R) - Math.sin(lat1) * Math.sin(lat2));

      return [lat2 * 180 / Math.PI, lon2 * 180 / Math.PI];
    }
  </script>
</body>
</html>




